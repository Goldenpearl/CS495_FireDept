<html>
<head>
	<link rel="stylesheet" type="text/css" href="tableStyle.css">
</head>
<body onload= "loadNavBar(); getData()">
	<div id="navbar"></div>
	<br>
	<h1>Shift Schedule</h1>
	<script src = "classes.js"></script><script>
	function loadNavBar() {
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (xhttp.readyState == 4 && xhttp.status == 200) {
		document.getElementById("navbar").innerHTML = xhttp.responseText;
		}
	}
	xhttp.open("GET", "navbar.html", true);
	xhttp.send();
	
	}
	
	function getData(){
		makeXmlRequest();
		//myFunction(myArr);
		var timeslots = new Array();
		timeslots.push(["Bob", 11]);
		timeslots.push(["Bob", 12]);
		timeslots.push(["Bob", 13]);
		timeslots.push(["Allan", 11]);
		timeslots.push(["Jess", 2]);
		createList(timeslots);
		createTable(timeslots);
	}
	function makeXmlRequest(){
		var xmlhttp = new XMLHttpRequest();
		var url = "KellyTxt.txt";
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				var myArr = JSON.parse(xmlhttp.responseText);
				myFunction(myArr);
			}
		};
		xmlhttp.open("GET", url, true);
		xmlhttp.send();
	}

	function myFunction(arr) {
		var out = "";
		var i;
		for(i = 0; i < arr.length; i++) {
			out += '<a href="' + arr[i].url + '">' + 
			arr[i].display + '</a><br>';
		}
	document.getElementById("id01").innerHTML = out;
}

	 function createTable(timeslots) {
	 
			//generate a table based on timeslots/ fire names
			//choose a start date and time
			//choose an end date and time
			//choose a divider or increment
			
			//create a "dummy table" with all the names and no time slots
			//for each timeslot, fill in relevant cells and link to the shift label
			
			var DAYS_IN_WEEK = 7;
			var HOURS_IN_DAY = 24;
			var MINUTES_IN_HOUR = 60;
			var names = ["Bob", "Allan", "Jess"];
			var timeHeader = new Array();
			timeHeader[0]="12:00 am";
			for(var i=1; i<12; i++){
				var str = i+":00 am";
				timeHeader[i] = str;;
			} 
			timeHeader[12] = "12:00 pm";
			for(var i=1; i<12; i++){
				var str = i+":00 pm";
				timeHeader[12+i]=str;
			} 		
			timeHeader[24] = "12:00 am";
            var employee = new Array();
            employee.push(["Employee Id", "Name", "Country"]);
            employee.push([1, "Harish Kumar", "United States"]);
            employee.push([2, "Pankaj Mohan", "India"]);
            employee.push([3, "Nitin Srivastav", "France"]);
            employee.push([4, "Ramchandra Verma", "Russia"]);

            var tablecontents = "";
            tablecontents = "<table border='1'>";

            for (var i = 0; i < employee.length; i++) {
                tablecontents += "<tr>";
                for (var j = 0; j < employee[i].length; j++) {

                    tablecontents += "<td>" + employee[i][j] + "</td>";
                }

                tablecontents += "</tr>";
            }
			tablecontents = "";
			tablecontents += "<table id = myTable>";
			tablecontents += "<tr>";
			tablecontents += "<th>";
			tablecontents += "</th>";
			for(var i =0; i< timeHeader.length; i++){
			tablecontents+="<th>";
			tablecontents+=timeHeader[i] +"</th>";
			}
			tablecontents += "</tr>"
			for(var i=0; i<names.length; i++){
				tablecontents+="<tr>";
				tablecontents+="<th>";
				tablecontents+= names[i];
				for(var j=0; j<timeHeader.length; j++){
				tablecontents+= "<td class=table-cell>";
				tablecontents+= "</td>";
				}
				tablecontents+="</th>";
				tablecontents+="</tr>";
			}
            tablecontents += "</table>";
			
			document.getElementById("tableDiv").innerHTML = tablecontents;
			for( var i=0; i<timeslots.length; i++){	
				var name = timeslots[i][0];
				var indexOfName = 0;
				var nameFound = false
				while(!nameFound && indexOfName<names.length){
					if(name === names[indexOfName])
					{
						nameFound=true;
					}
					else{
					indexOfName++;
					}
				}
				if(nameFound){
				document.getElementById('myTable').rows[indexOfName+1].cells[timeslots[i][1]+1].setAttribute("bgcolor", "#00FF00");
				}
			}
		}
	
		function createList(timeslots){
			var listContents = "";
			//alert(timeslots.length);
			for(var n=0; n<timeslots.length; n++){
			 listContents+=timeslots[n][0] + " " + indexToTime(timeslots[n][1])+ "<br>";
			}
			document.getElementById("listDiv").innerHTML = listContents;
		}
		
		function indexToTime(index){
			var realIndex = index%24;
			var time = "";
			var m = "";
			if(index<=0){
				time+="12:00 am";
			}
			else if(index>12){
				m="pm";
				time+=index%12+":00 "+m;
			}
			else{
			m = "am"
			time+=index+":00 "+m;
			}
			return time;
		}
	
	</script>
	
	<div id=listDiv> </div>
	<br><br>
	<h1>Table Schedule</h3>
	<div id=tableDiv></div>
</body>
</html>